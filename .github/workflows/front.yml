name: ci frontend

on:
  pull_request:
    paths:
      - 'front/**'
      - '.github/workflows/front.yml'
  # @TODO: chramatic入れたらやる
  # push:
  #   branches:
  #     - main

permissions:
  id-token: write
  contents: read
  actions: read
  pull-requests: write

env:
  AWS_REGION: ap-northeast-1

jobs:
  front_test:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    env:
      LANG: ja_JP.UTF-8
      LC_CTYPE: ja_JP.UTF-8
    defaults:
      run:
        working-directory: front
    steps:
      - name: Cancel Previous Runs
        uses: styfle/cancel-workflow-action@85880fa0301c86cca9da44039ee3bb12d3bedbfa # 0.12.1
        with:
          access_token: ${{ github.token }}
      - uses: actions/checkout@v4
      - name: Use Node.js
        uses: actions/setup-node@v4
        with:
          node-version-file: '.node-version'

      - uses: oven-sh/setup-bun@v1
      - run: bun install
      - run: bun lint-ts

      - run: bun type-check
        working-directory: front/src/app
      - run: bun type-check
        working-directory: front/src/modules

      - run: bun vitest
        working-directory: front/src/app
      - run: bun vitest
        working-directory: front/src/modules

      - run: bun build-remix
        working-directory: front/src/app
      - run: bun build-remix
        working-directory: front/src/admin